<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–∞–ª–µ—Ä–µ—è –ò—Å–∫—É—Å—Å—Ç–≤–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #000;
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
            position: relative;
        }

        /* –ó–≤—ë–∑–¥–Ω–æ–µ –Ω–µ–±–æ */
        body::before {
            content: '';
            position: fixed;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 60% 70%, white, transparent),
                radial-gradient(1px 1px at 50% 50%, white, transparent),
                radial-gradient(1px 1px at 80% 10%, white, transparent),
                radial-gradient(2px 2px at 90% 60%, white, transparent),
                radial-gradient(1px 1px at 33% 80%, white, transparent),
                radial-gradient(1px 1px at 15% 60%, white, transparent);
            background-size: 200% 200%;
            background-position: 0% 0%;
            opacity: 0.4;
            z-index: 0;
        }

        .container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 1500px;
            position: relative;
            z-index: 1;
            padding: 80px 20px 60px;
        }

        .header {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
        }

        .header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            font-weight: 300;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .artwork-container {
            width: 100%;
            max-width: 1400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            animation: fadeIn 1s ease-in;
        }

        /* –í–µ—Ä—Ö–Ω–∏–π —Ç–µ–∫—Å—Ç (–Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∞–≤—Ç–æ—Ä) - —É—Ö–æ–¥–∏—Ç –í–ù–ò–ó –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é */
        .text-top {
            width: 100%;
            max-width: 900px;
            text-align: center;
            margin-bottom: 30px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 60px –¥–æ 30px */
            transform: perspective(800px) rotateX(-20deg);
            transform-origin: top center;
            padding: 0 20px;
        }

        .title {
            font-size: clamp(1.5rem, 4vw, 3rem);
            font-weight: 700;
            color: #edfc86;
            margin-bottom: 15px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 20px –¥–æ 15px */
            line-height: 1.2;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            letter-spacing: 0.05em;
        }

        .author {
            font-size: clamp(1rem, 2vw, 1.5rem);
            color: rgba(255, 255, 255, 0.9);
            font-weight: 400;
            letter-spacing: 0.08em;
        }

        /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–π –º–∞—Å–∫–æ–π */
        .image-container {
            width: 100%;
            max-width: 900px;
            position: relative;
            margin: 20px 0; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 40px –¥–æ 20px */
            padding: 0 20px;
        }

        .image-mask {
            width: 100%;
            max-width: 100%;
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 
                0 0 80px rgba(255, 215, 0, 0.3),
                inset 0 0 100px rgba(0, 0, 0, 0.6);
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –ø–æ—è–≤–ª–µ–Ω–∏—è –∏–∑ —Ç–µ–º–Ω–æ—Ç—ã - —Ä–∞–∑–º—ã—Ç—ã–µ –∫—Ä–∞—è */
        .image-mask::before {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                linear-gradient(to right, rgba(0,0,0,0.9) 0%, transparent 15%, transparent 85%, rgba(0,0,0,0.9) 100%),
                linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, transparent 15%, transparent 85%, rgba(0,0,0,0.9) 100%);
            z-index: 2;
            pointer-events: none;
        }

        /* –í–Ω–µ—à–Ω–µ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
        .image-mask::after {
            content: '';
            position: absolute;
            inset: -30px;
            background: radial-gradient(ellipse at center, transparent 40%, black 100%);
            filter: blur(40px);
            z-index: -1;
        }

        .image-mask img {
            width: 100%;
            height: auto;
            display: block;
            position: relative;
            z-index: 1;
            filter: brightness(0.9) contrast(1.1);
            opacity: 0;
            transform: scale(1.05);
            transition: opacity 1.5s ease-out, transform 2s ease-out;
        }

        .image-mask img.loaded {
            opacity: 1;
            transform: scale(1);
        }

        .no-image {
            width: 100%;
            aspect-ratio: 4/3;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.3);
            font-size: 1rem;
            background: rgba(0, 0, 0, 0.5);
        }

        /* –ù–∏–∂–Ω–∏–π —Ç–µ–∫—Å—Ç (–º—É–∑–µ–π, –ø–µ—Ä–∏–æ–¥, —Ç–µ—Ö–Ω–∏–∫–∞) - —É—Ö–æ–¥–∏—Ç –í–í–ï–†–• –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é */
        .text-bottom {
            width: 100%;
            max-width: 1000px;
            text-align: center;
            margin-top: 30px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 60px –¥–æ 30px */
           /*  transform: perspective(800px) rotateX(20deg); */
            transform-origin: bottom center;
            padding: 0 20px;
        }

        .info-row {
            margin: 12px 0; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 15px –¥–æ 12px */
        }

        .info-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: rgba(255, 215, 0, 0.7);
            margin-bottom: 4px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 5px –¥–æ 4px */
            font-weight: 600;
        }

        .info-value {
            font-size: clamp(0.9rem, 2vw, 1.2rem);
            color: rgba(255, 255, 255, 0.85);
            line-height: 1.4;
            letter-spacing: 0.05em;
        }

        .id-value {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 20px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 30px –¥–æ 20px */
            letter-spacing: 0.1em;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.4;
            }
        }

        /* –ù–æ–≤–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
        @keyframes imageReveal {
            0% {
                opacity: 0;
                transform: scale(1.08);
                filter: brightness(0.3) contrast(0.7);
            }
            70% {
                opacity: 0.8;
                filter: brightness(0.8) contrast(1);
            }
            100% {
                opacity: 1;
                transform: scale(1);
                filter: brightness(0.9) contrast(1.1);
            }
        }

        .image-reveal {
            animation: imageReveal 2.5s ease-out forwards;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –ø–ª–∞–Ω—à–µ—Ç–æ–≤ */
        @media (max-width: 1024px) {
            .container {
                padding: 70px 15px 50px;
            }

            .text-top {
                margin-bottom: 25px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 50px –¥–æ 25px */
            }

            .text-bottom {
                margin-top: 25px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 50px –¥–æ 25px */
            }

            .image-container {
                max-width: 700px;
                margin: 15px 0; /* –£–º–µ–Ω—å—à–µ–Ω–æ */
            }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 768px) {
            .container {
                padding: 60px 10px 40px;
            }

            .header p {
                font-size: 0.65rem;
                padding: 0 10px;
            }

            .text-top {
                margin-bottom: 20px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 40px –¥–æ 20px */
                transform: perspective(500px) rotateX(-15deg);
            }

            .text-bottom {
                margin-top: 20px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 40px –¥–æ 20px */
                transform: perspective(500px) rotateX(15deg);
            }

            .image-container {
                max-width: 100%;
                margin: 15px 0; /* –£–º–µ–Ω—å—à–µ–Ω–æ */
            }

            .image-mask {
                border-radius: 8px;
            }

            .info-row {
                margin: 10px 0; /* –£–º–µ–Ω—å—à–µ–Ω–æ */
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 50px 10px 30px;
            }

            .text-top {
                margin-bottom: 15px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 30px –¥–æ 15px */
            }

            .text-bottom {
                margin-top: 15px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 30px –¥–æ 15px */
            }

            .info-row {
                margin: 8px 0; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 12px –¥–æ 8px */
            }

            .id-value {
                margin-top: 15px; /* –£–º–µ–Ω—å—à–µ–Ω–æ */
            }
        }

        /* –î–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (min-width: 1920px) {
            .container {
                padding: 100px 40px 80px;
            }

            .artwork-container {
                max-width: 1600px;
            }

            .image-container {
                max-width: 1200px;
            }

            .text-top, .text-bottom {
                max-width: 1200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <p>–°–ª—É—á–∞–π–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –º—É–∑–µ–µ–≤</p>
        </div>

        <div id="app">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è...</div>
        </div>
    </div>

    <script>
        const FUNCTION_URL = 'https://d5dos0886b1g86mpgl8d.pdkwbi1w.apigw.yandexcloud.net';

        function getProxyUrl(originalUrl) {
            if (!originalUrl) return '';
            const match = originalUrl.match(/\/([^\/?#]+)$/);
            const id = match ? match[1] : '';
            return id ? `${FUNCTION_URL}/proxy/${id}` : '';
        }

        function renderArtwork(artwork) {
            const data = artwork.data || {};
            
            const imageUrl = data.images && data.images.length > 0 
                ? getProxyUrl(data.images[0]?.url) 
                : '';

            const name = data.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
            
            let authors = '';
            if (data.authors) {
                if (Array.isArray(data.authors)) {
                    authors = data.authors.join(', ');
                } else {
                    authors = data.authors;
                }
            }
            
            const technologies = data.technologies && data.technologies.length > 0
                ? data.technologies.join(', ')
                : '';
            
            const museum = data.museum?.name || '';
            const period = data.periodStr || '';
            const nativeId = artwork.nativeId || data.id || '';

            console.log('Rendering artwork:', { name, authors, technologies, museum, period, nativeId, imageUrl });

            return `
                <div class="artwork-container">
                    <!-- –í–µ—Ä—Ö–Ω–∏–π —Ç–µ–∫—Å—Ç - —É—Ö–æ–¥–∏—Ç –≤–Ω–∏–∑ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é -->
                    <div class="text-top">
                        <h1 class="title">${name}</h1>
                        ${authors ? `<div class="author">${authors}</div>` : ''}
                    </div>

                    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–π –º–∞—Å–∫–æ–π -->
                    <div class="image-container">
                        <div class="image-mask">
                            ${imageUrl ? `
                                <img src="${imageUrl}" 
                                     alt="${name}" 
                                     onload="this.classList.add('image-reveal')"
                                     onerror="this.parentElement.innerHTML='<div class=no-image>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</div>'">
                            ` : '<div class="no-image">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</div>'}
                        </div>
                    </div>

                    <!-- –ù–∏–∂–Ω–∏–π —Ç–µ–∫—Å—Ç - —É—Ö–æ–¥–∏—Ç –≤–≤–µ—Ä—Ö –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é -->
                    <div class="text-bottom">
                        ${museum ? `
                            <div class="info-row">
                                <div class="info-label">–ú—É–∑–µ–π</div>
                                <div class="info-value">${museum}</div>
                            </div>
                        ` : ''}
                        
                        ${period ? `
                            <div class="info-row">
                                <div class="info-label">–ü–µ—Ä–∏–æ–¥</div>
                                <div class="info-value">${period}</div>
                            </div>
                        ` : ''}
                        
                        ${technologies ? `
                            <div class="info-row">
                                <div class="info-label">–¢–µ—Ö–Ω–∏–∫–∞</div>
                                <div class="info-value">${technologies}</div>
                            </div>
                        ` : ''}

                        <div class="id-value">ID: ${nativeId}</div>
                    </div>
                </div>
            `;
        }

        async function loadRandomArtwork() {
            const app = document.getElementById('app');
            
            try {
                console.log('üîÑ –ó–∞–ø—Ä–æ—Å –∫:', `${FUNCTION_URL}/api/artworks/random`);
                
                const response = await fetch(`${FUNCTION_URL}/api/artworks/random`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', data);
                console.log('üìä –î–ª–∏–Ω–∞ –º–∞—Å—Å–∏–≤–∞ data.data:', data.data?.length);
                
                if (data.data && data.data.length > 0) {
                    app.innerHTML = renderArtwork(data.data[0]);
                } else {
                    console.log('‚ö†Ô∏è –ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É...');
                    setTimeout(() => location.reload(), 500);
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞:', error);
                app.innerHTML = `<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞</div>`;
                setTimeout(() => location.reload(), 1000);
            }
        }

        window.addEventListener('DOMContentLoaded', loadRandomArtwork);
    </script>
</body>
</html>
